# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

# How do I allow non-mandatory params
# How do I pass params from external input
parameters:

- name: processName
  type: string
  default: ""
  
- name: componentId
  type: string
  default: ""

- name: componentType
  type: string
  default: 'process'

- name: componentVersion
  type: string
  default: 'NA'

- name: notes
  type: string
  default: ''

- name: packageVersion
  type: string

- name: extractComponentXmlFolder
  type: string
  default: 'true'

- name: tag
  type: string
  default: 'true'  

- name: listenerStatus
  type: string
  default: 'RUNNING'



variables:
- group: boomicicd

# need a new image with SonarRunner and xmllint (libxml2-utils) and jq
pool:
  vmImage: 'ubuntu-latest'

steps:

- script: |
    # Don't have to do this if the image comes preloaded with this package
    sudo apt-get install -y libxml2-utils
    cd cli/scripts
	source bin/exports_ado.sh

    source bin/createPackage.sh \
      processName="${{ parameters.processName }}" \
      componentId="${{ parameters.componentId }}" \
      componentType=${{ parameters.componentType }} \
      componentVersion=${{ parameters.componentVersion }} \
      packageVersion="${{ parameters.packageVersion }}" \
      notes="${{ parameters.notes }}" \
      extractComponentXmlFolder="${{ parameters.extractComponentXmlFolder }}" \
      tag="${{ parameters.tag }}" \
      listenerStatus=${{ parameters.listenerStatus }}
    
  displayName: 'Boomi Create Package'
